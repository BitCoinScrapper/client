
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>BitcoinScanner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
</head>
<body>

    <!-- NAVBAR -->

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
            <div class="container">
                <li class="navbar-brand">BitcoinScanner</li>
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" id="loginButton">Login</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="logoutButton">Logout</a>
                    </li>
                </ul>
            </div>
        </nav>


    <div class="container mt-5">
        <div class="row">
                <div class="col">
                    <h2>Trades</h2>

                    <table class="table table-sm">
                        <thead>
                            <tr>
                            <th scope="col">Amount</th>
                            <th scope="col">Price</th>
                            <th scope="col">Time</th>
                            </tr>
                        </thead>
                        <tbody id="tradesTable">

                        </tbody>
                    </table>


                </div>
                <div class="col">
                    <div class="col">
                        <h2>Order - Sell</h2>
    
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                <th scope="col">Price</th>
                                <th scope="col">Size</th>
                                </tr>
                            </thead>
                            <tbody id="sellTable">

                            </tbody>
                        </table>
                    </div>
                </div>



                <div class="col">
                    <h2>Order - Buy</h2>

                    <table class="table table-sm">
                        <thead>
                            <tr>
                            <th scope="col">Price</th>
                            <th scope="col">Size</th>
                            </tr>
                        </thead>
                        <tbody id="buyTable">

                        </tbody>
                    </table>
                </div>
        </div>

        <hr class="my-5">

        <div class="row text-center"> 
            <div class="col">
                <h4 class="font-weight-bold" id="last"> </h4>
                <p class="font-weight-light" id="last-USD"> </p>
                <p>last</p>
            </div>
            <div class="col">
                <h4 class="font-weight-bold" id="buy"> </h4>
                <p class="font-weight-light" id="buy-USD"> </p>
                <p>buy</p>
            </div>
            <div class="col">
                <h4 class="font-weight-bold" id="sell"> </h4>
                <p class="font-weight-light" id="sell-USD"> </p>
                <p>sell</p>
            </div>
            <div class="col">
                <h4 class="font-weight-bold" id="vol_btc"> </h4>
                <p> - </p>
                <p>vol_btc</p>
            </div>
        </div>
    </div>

    

    

    <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>


    <script>
        $(document).ready(function() {
            console.log( "ready!" );
            getIndodax()
        })
        

        
        function getIndodax() {
            // convertTime:
            function convertTime(date) {
                let time = new Date(date)
                return `${time.getHours()}:${time.getMinutes()}:${time.getSeconds()}`
            }

            // TRADES:
            $.ajax({
                method: 'GET',
                url: 'http://localhost:3000/indodax/btc/trades'
            })
                .done( response => {
                    $('#tradesTable').empty()
                    console.log(response.slice(0,10));
                    $.each(response.slice(0,10), function (index, value) {
                        $('#tradesTable').append(`
                            <tr>
                            <td>${value.amount}</td>
                            <td>${value.price}</td>
                            <td>${convertTime(value.date)}</td>
                            </tr>
                        `)
                    })
                })
                .fail( err => {
                    console.log(err);
                })

            // TICKER:
            $.ajax({
                method: 'GET',
                url: 'http://localhost:3000/indodax/btc/ticker'
            })
                .done( response => {
                    $('#last').text(new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(response.last))
                    $('#buy').text(new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(response.buy))
                    $('#sell').text(new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(response.sell))
                    $('#vol_btc').text(new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'BTC' }).format(response.vol_btc))

                    $.ajax({
                        method: 'GET',
                        url: 'https://api.openrates.io/latest?base=IDR'
                    })
                        .done( convert => {
                            let USDrate = convert.rates.USD

                            let USDlast = response.last * USDrate
                            $('#last-USD').text(new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'USD' }).format(USDlast))

                            let USDbuy = response.buy * USDrate
                            $('#buy-USD').text(new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'USD' }).format(USDbuy))

                            let USDsell = response.sell * USDrate
                            $('#sell-USD').text(new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'USD' }).format(USDsell))
                        })
                        .fail( err => {
                            console.log(err, 'from convert currency API');
                        })
                })
                .fail( err => {
                    console.log(err, 'from ticker');
                })

            // DEPTH: 
            $.ajax({
                method: 'GET',
                url: 'http://localhost:3000/indodax/btc/depth'
            })
                .done( response => {
                    let buy = response.buy.slice(0,10)
                    let sell = response.sell.slice(0, 10)
                    $('#sellTable').empty()
                    $.each(sell, function (index, value) {
                        $('#sellTable').append(`
                            <tr>
                            <td>${new Intl.NumberFormat('id-ID', { style: 'decimal' }).format(value.price)}</td>
                            <td>${value.size}</td>
                            </tr>
                        `)
                    })
                    
                    $('#buyTable').empty()
                    $.each(sell, function (index, value) {
                        $('#buyTable').append(`
                            <tr>
                            <td>${new Intl.NumberFormat('id-ID', { style: 'decimal' }).format(value.price)}</td>
                            <td>${value.size}</td>
                            </tr>
                        `)
                    })
                })
                .fail( err => {
                    console.log(err);
                })
        }



    </script>
</body>
</html>